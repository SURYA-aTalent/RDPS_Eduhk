<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      layout:decorate="~{fragments/template}">

<!-- File Path: src/main/resources/templates/importHistory.html -->
<!-- Purpose: View history of past imports -->

<head>
<title>Import History</title>
</head>
<body>
	<div layout:fragment="content">

		<!-- Import History Card -->
		<div class="card">
			<div class="card-header">
				<h3 class="card-title mb-4">Import History</h3>
				<h6 class="card-subtitle">View past data import operations</h6>
			</div>

			<div class="card-body">

				<!-- Back Button -->
				<div class="row mb-3">
					<div class="col-md-12">
						<a th:href="@{/import/data}" class="btn btn-secondary">
							<i class="fa fa-arrow-left"></i> Back to Import Dashboard
						</a>
					</div>
				</div>

				<!-- Import History Table -->
				<div class="row">
					<div class="col-md-12">
						<table class="table table-striped table-bordered" id="historyTable">
							<thead class="thead-dark">
								<tr>
									<th>Import Date</th>
									<th>Triggered By</th>
									<th>Status</th>
									<th>Total</th>
									<th>Successful</th>
									<th>Failed</th>
								</tr>
							</thead>
							<tbody>
								<tr th:if="${#lists.isEmpty(importHistory)}">
									<td colspan="6" class="text-center">
										<em>No import history available yet.</em>
									</td>
								</tr>
								<tr th:each="history : ${importHistory}">
									<td th:text="${#dates.format(history.importDate, 'yyyy-MM-dd HH:mm:ss')}">2023-10-17 10:00:00</td>
									<td th:text="${history.triggeredBy}">SYSTEM</td>
									<td>
										<span class="badge"
										      th:classappend="${history.status == 'COMPLETED'} ? 'badge-success' :
										                      (${history.status == 'FAILED'} ? 'badge-danger' : 'badge-warning')"
										      th:text="${history.status}">COMPLETED</span>
									</td>
									<td th:text="${history.totalCandidates}">100</td>
									<td class="text-success" th:text="${history.successfulImports}">95</td>
									<td class="text-danger" th:text="${history.failedImports}">5</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>
		</div>

	</div>

	<div layout:fragment="scripts">
		<script th:inline="javascript">
		/*<![CDATA[*/
		$(document).ready(function() {
			// Initialize DataTable for pagination
			if ($.fn.DataTable) {
				$('#historyTable').DataTable({
					"order": [[0, "desc"]], // Sort by date descending
					"pageLength": 25,
					"responsive": true,
					"language": {
						"emptyTable": "No import history available yet."
					}
				});
			}
		});
		/*]]>*/
		</script>
	</div>

</body>
</html>
